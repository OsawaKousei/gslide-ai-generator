# Vite CSR App Template

これは、**Vite** と **React** を使用してクライアントサイドレンダリング (CSR) アプリケーションを構築するためのテンプレートリポジトリです。
Docker ベースの開発環境、本番用ビルドスクリプト、およびサンプルアプリケーション (五目並べ SPA) が事前に構成されています。

## 特徴

- **Docker 化された開発環境:** Docker Compose を使用した完全にコンテナ化された開発環境。
- **本番環境対応:** 最適化された本番用イメージのビルドと静的成果物の抽出を行うスクリプトが含まれています。
- **テンプレートリポジトリ:** このテンプレートから新しいリポジトリを作成すると、プロジェクト名と設定が自動的に初期化されます。
- **モダンなスタック:** Vite, React, TypeScript, Tailwind CSS, Vitest で構成されています。
- **サンプルアプリ:** 実装の参考として、完全な五目並べ (Gomoku) SPA が含まれています。

## 始め方

### 1. リポジトリの作成

GitHub 上の **"Use this template"** ボタンをクリックして、このテンプレートに基づいた新しいリポジトリを作成してください。
含まれている GitHub Actions ワークフローが、新しいリポジトリ名に合わせて `package.json` と `docker-compose.yaml` を自動的に更新します。

### 2. 開発環境の起動

以下のコマンドを実行して、開発サーバーを起動します。

```bash
docker compose up
```

アプリケーションは `http://localhost:5173` で利用可能になります。
`app/` ディレクトリはコンテナ内にマウントされているため、ソースコードへの変更は即座に反映されます (HMR)。

### ⚠️ 重要: 初期セットアップ

**リポジトリ作成後、ビルドスクリプトを実行する前に、必ずコンテナ内で \`npm install\` を少なくとも 1 回実行してください。**

初期化プロセスでは、クリーンな状態を保証するために既存の `package-lock.json` を削除します。しかし、本番用ビルドスクリプト (`build-prod.sh`) は、`package-lock.json` が存在し、有効であることを前提としています。

コンテナ内で以下のコマンドを実行して、`package-lock.json` を生成し、依存関係を同期してください。

```bash
npm install
```

**この手順をスキップすると、有効なロックファイルが見つからないため、本番用ビルドスクリプト (`build-prod.sh`) は失敗します。**

### 3. 本番用ビルド

アプリケーションを本番用にビルドするには、提供されているスクリプトを使用します。

```bash
./build-prod.sh
```

このスクリプトは以下の処理を行います：

1. `Dockerfile.prod` を使用して Docker イメージをビルドします。
2. ビルドされた静的ファイル (HTML, CSS, JS) をホストマシンの `dist/` ディレクトリに抽出します。

その後、`dist/` ディレクトリの内容を任意の静的ホスティングサービス (AWS S3 + CloudFront, Vercel, Nginx など) にデプロイできます。

### 4. 本番ビルドのプレビュー

Nginx を使用してローカルで本番ビルドをプレビューするには、以下を実行します。

```bash
./preview-prod.sh
```

これにより、ビルドされたアプリケーションを提供するローカル Nginx コンテナが起動し、`http://localhost:8080` でアクセスできるようになります。

## アプリケーションの詳細

Web アプリケーションのソースコードは `app/` ディレクトリにあります。
サンプルである五目並べアプリケーションの実装、アーキテクチャ、仕様の詳細については、以下を参照してください。

👉 **[app/README.md](./app/README.md)**

## プロジェクト構造

```
.
├── app/ # アプリケーションのソースコード
│ ├── src/ # React コンポーネントとロジック
│ ├── docs/ # ドキュメントと仕様書
│ └── ...
├── dist/ # 本番ビルド成果物の出力ディレクトリ
├── build-prod.sh # ビルドと成果物抽出用スクリプト
├── preview-prod.sh # 本番ビルドプレビュー用スクリプト
├── docker-compose.yaml # 開発用 Docker Compose 設定
├── Dockerfile.dev # 開発用 Dockerfile
└── Dockerfile.prod # 本番用 Dockerfile
```
